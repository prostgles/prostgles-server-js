
	  
<!DOCTYPE html>
<html>
	<head>
        <title> Prostgles </title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://unpkg.com/socket.io-client@2.3.0/dist/socket.io.slim.js" type="text/javascript"></script>
        <script src="https://unpkg.com/prostgles-client@1.0.1/dist/index.js" type="text/javascript"></script>	
	</head>
	<body>
        <input type = "file"/>
        
        <div class="wrapper"></div>
		<script>
            
            const socket = io();

            prostgles({
                socket, 
                isReady: (db, methods) => {
                    window.db = db;
                    db.pixels.subscribe({ blb: { $not: null }}, { limit: 2 }, items => {
                        let div = document.querySelector(".wrapper");
                        div.innerHTML = "";

                        items.map(item => {
                            let img = document.createElement("img");
                            var bytes = new Uint8Array(item.blb);

                            img.style = "width: 100px; height: 100px;";
                            img.src = 'data:image/jpg;base64, ' + arrayBufferToBase64(item.blb)
                            div.append(img);
                        });
                    });

                    function arrayBufferToBase64( buffer ) {
                        var binary = '';
                        var bytes = new Uint8Array( buffer );
                        var len = bytes.byteLength;
                        for (var i = 0; i < len; i++) {
                            binary += String.fromCharCode( bytes[ i ] );
                        }
                        return window.btoa( binary );
                    }


                    document.querySelector("input").onchange = e => {
                        methods.upload(e.target.files[0])
                    }
                },
                onDisconnect: (err, res) => {
                    // location.reload();
                }
            });
		</script>
	</body>
</html>
